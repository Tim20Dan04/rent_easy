{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль Арендодателя</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <a href="{% url 'home' %}">Главная</a>
    <header>
        <h2>Поиск жилья</h2>
    </header>
    <main>
        <!-- listings/templates/listings/property_search.html -->
        <h1>Поиск недвижимости</h1>

        <form method="get" action="/search/">
            {{ form.as_p }}
            <button type="submit">Поиск</button>
        </form>

        <ul>
            {% for property in properties %}
                <li>
                    <h2>{{ property.title }}</h2>
                    <p>{{ property.description }}</p>
                    <p>Цена: {{ property.price }} руб.</p>
                    <p>Арендодатель: {{ property.landlord.name }}</p>
                </li>
            {% empty %}
                <li>Нет доступной недвижимости по заданным критериям.</li>
            {% endfor %}
        </ul>
        <div class="pagination">
            <span class="step-links">
                {% if page_obj.has_previous %}
                    <a href="?{% if request.GET.country %}country={{ request.GET.country }}&{% endif %}
                              {% if request.GET.city %}city={{ request.GET.city }}&{% endif %}
                              page={{ page_obj.previous_page_number }}">← Предыдущая</a>
                {% endif %}
        
                <span class="current">
                    Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}
                </span>
        
                {% if page_obj.has_next %}
                    <a href="?{% if request.GET.country %}country={{ request.GET.country }}&{% endif %}
                              {% if request.GET.city %}city={{ request.GET.city }}&{% endif %}
                              page={{ page_obj.next_page_number }}">Следующая →</a>
                {% endif %}
            </span>
        </div>
    </main>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#id_country').change(function () {
                const countryId = $(this).val();  // Получаем выбранную страну
                if (countryId) {
                    $.ajax({
                        url: '/ajax/load-cities/',  // URL из urls.py
                        data: {
                            country_id: countryId  // Передаем ID страны
                        },
                        success: function (data) {
                            const citySelect = $('#id_city');
                            citySelect.empty();  // Очищаем старые данные
                            citySelect.append('<option value="">---------</option>');  // Добавляем пустую опцию
                            data.cities.forEach(function (city) {
                                citySelect.append(new Option(city.name, city.id));  // Добавляем новые опции
                            });
                        }
                    });
                } else {
                    $('#id_city').empty();  // Если страна не выбрана, очищаем список городов
                }
            });
        });
    </script>
</body>
